FROM debian:buster

#apt update and install the dependencies we need
RUN apt-get update && apt-get install -y \
    php-fpm \
    php-mysql \
    mariadb-client \
    wget

#install wp-cli and set it up
RUN wget https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar && \
    chmod +x wp-cli.phar && \
    mv wp-cli.phar /usr/local/bin/wp && \
    wp --allow-root core download

RUN wp core config --allow-root --dbhost=mariadb --dbname=wordpress --dbuser=reguser --dbpass=regpassword && \
    chmod 644 wp-config.php && \
    wp core install --allow-root --title="Wordpress" --admin_name="notuser" --admin_password="notpassword" --admin_email="ok@ok.nl" --url="https://localhost/wordpress"

    #   - WORDPRESS_DB_NAME=wordpress
    #   - WORDPRESS_DB_HOST=mariadb
    #   - WORDPRESS_DB_USER=reguser
    #   - WORDPRESS_DB_PASSWORD=regpassword

# RUN tar xfz latest.tar.gz --strip-components=1 -C /var/www/html/wordpress/


CMD ["sleep", "infinity"]